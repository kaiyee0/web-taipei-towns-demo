var value1=window.localStorage.getItem("fdsettings"),value2=JSON.parse(value1),mean=window.localStorage.getItem("mean"),factor=window.localStorage.getItem("factor");document.getElementById("factor").innerHTML=factor;var width=900,height=650,projection=d3.geo.mercator().scale(11e4).center([121.58,25.11]),graticule=d3.geo.graticule().step([2,2]),path=d3.geo.path().projection(projection),svg=d3.select("#container").append("svg").attr("width",width).attr("height",height);svg.append("path").datum(graticule).attr("class","graticule").attr("d",path),d3.json("taipei.json",function(e,t){function a(e){var t=$(value2).filter(function(t,a){return a.district==e});return t[0].id}function n(e){return e>1.25*mean?"dangerous":.7*mean>e?"harmonic and joyful":"peace"}root=jQuery.parseJSON(JSON.stringify(value2));var r=topojson.feature(t,t.objects.map),o=d3.scale.linear().domain([.5*mean,1.4*mean]).range(["#FFCCCC","#CC0000"]);svg.selectAll(".name").data(r.features).enter().append("path").attr("d",path).attr("class","name").style("fill",function(e){return o(a(e.properties.name))}).on("mouseover",function(e){var t=d3.event.pageX,r=d3.event.pageY-40;d3.select("#tooltip").style("left",t+"px").style("top",r+"px").style("opacity",1).text(e.properties.name+" is "+n(a(e.properties.name)))}).on("mouseout",function(){d3.select("#tooltip").style("opacity",0)}),d3.select("svg").append("g").attr("class","legendLinear").attr("transform","translate(200,580)");var l=d3.legend.color().title("Crime Committed Index").shapeHeight(20).shapeWidth(60).shapeRadius(10).cells([.5*mean,.75*mean,mean,1.2*mean,1.3*mean]).orient("horizontal").labelFormat(d3.format(".02f")).labelAlign("start").scale(o);svg.select(".legendLinear").call(l)});